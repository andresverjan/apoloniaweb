<mat-card-actions fxLayout="row" fxLayoutAlign="end center" style="margin-right: 10px; margin-bottom: 2px">
  <button mat-raised-button fxLayout="row" fxLayout.xs="column" fxLayoutAlign="center" fxFlex="22"
    (click)="onClickAdicionar()" color="primary" *ngIf="showListado">
    <mat-icon>add_circle_outline</mat-icon>
    Adici칩n
  </button>
</mat-card-actions>
<mat-progress-bar mode="indeterminate" *ngIf="IsWaiting"></mat-progress-bar>

<div class="container" *ngIf="showListado" style="overflow: hidden">
  <div>
    <mat-card fxFill>
      <mat-card-title fxLayoutAlign="center">
        <label>BUSCAR</label>
      </mat-card-title>
      <mat-card-content fxLayout="column" fxLayoutAlign="center" style="margin: 0px;">
        <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
          <mat-icon matPrefix>search</mat-icon>
          <mat-form-field fxFlex="100">
            <input matInput id="filterbyFactura" placeholder="Factura" [(ngModel)]="filter.T17Factura"
              (keyup)="findBy()" />
          </mat-form-field>
          <mat-form-field fxFlex="100">
            <mat-label>Fecha Inicio</mat-label>
            <input matInput [matDatepicker]="picker1" (dateChange)="onDateChangeInicial($event)"
              (focus)="picker1.open()" [value]="filter['T17FechaIni']" readonly />
            <mat-datepicker-toggle matSuffix [for]="picker1"></mat-datepicker-toggle>
            <mat-datepicker #picker1></mat-datepicker>
          </mat-form-field>
          <mat-form-field fxFlex="100">
            <mat-label>Fecha Final</mat-label>
            <input matInput [matDatepicker]="picker2" (dateChange)="onDateChangeFinal($event)" (focus)="picker2.open()"
              [value]="filter['T17FechaFin']" readonly />
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
          </mat-form-field>
        </div>
      </mat-card-content>

      <mat-paginator [length]="totalRegistros" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions"
        (page)="handlePageChange($event)">
      </mat-paginator>
      <mat-grid-list cols="5" rowHeight="230px">
        <mat-grid-tile *ngFor="let egreso of egresos" style="overflow-x: hidden">
          <mat-card (click)="verDetalle(egreso)" class="dashboard-card">
            <mat-card-content class="dashboard-card-content">
              <mat-icon>attach_money</mat-icon>
              {{egreso.nombre}}
              <h5 class="cssRow">
                <small>Prov:</small>                                
                {{ egreso.T17Proveedor }}
              </h5>
              <div>
                Total:
                <strong>
                  {{ formatCurrency(egreso.T17Total) }}
                </strong>
              </div>
            </mat-card-content>
          </mat-card>
        </mat-grid-tile>
      </mat-grid-list>

    </mat-card>
  </div>
</div>

<div class="container" *ngIf="!showListado" style="overflow: hidden">
  <mat-card-content class="window-dashboard-card-content contentprincipal">
    <mat-toolbar style="display: flex; flex-direction: row" color="primary">
      <mat-icon matPrefix>account_balance</mat-icon>
      <label style="margin-bottom: 0"> Configuraci칩n de Egresos </label>
      <span class="example-spacer"></span>
      <button (click)="eliminar()" *ngIf="showBtnEliminar" style="align-self: center; justify-self: center"
        mat-icon-button color="secondary">
        <mat-icon>delete_outline</mat-icon>
      </button>
      <button mat-icon-button class="example-icon" (click)="cancelar()">
        <mat-icon>close</mat-icon>
      </button>
    </mat-toolbar>

    <mat-card-header>
      <mat-card-title></mat-card-title>
    </mat-card-header>
    <mat-card class="cardcontent">
      <mat-card-content fxLayout="column" fxLayoutAlign="center">
        <div fxLayout="column" fxLayoutAlign="space-between " fxFlex="100">
          <form [formGroup]="egresoForm" autocomplete="off" novalidate>
            <mat-card class="cardcontent">
              <mat-card-content fxLayout="column" fxLayoutAlign="center">
                <div fxLayout="row" fxFlex fxLayoutAlign="center center">
                  <mat-form-field fxFlex="60">
                    <mat-icon matPrefix>note</mat-icon>
                    <input matInput formControlName="nombre" id="nombre" placeholder="Nombre Personalizado" />
                  </mat-form-field> 
                </div>
                <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
                  <mat-form-field fxFlex>
                    <mat-icon matPrefix>note</mat-icon>
                    <input matInput formControlName="T17Factura" id="T17Factura" placeholder="Numero de Factura" />
                  </mat-form-field>

                  <mat-form-field fxFlex>
                    <mat-icon matPrefix>edit</mat-icon>
                    <input matInput formControlName="T17Soporte" id="T17Soporte" placeholder="Numero de Soporte" />
                  </mat-form-field>
                </div>

                <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
                  <div fxLayout="row" fxLayoutAlign="center" fxFlex="50">
                    <mat-label style="padding: 10px;">Proveedor</mat-label>
                    <app-buscadormodal [filters]="['Nombre', 'Nit']" (selected)="onPorveedorSelected($event)"
                      [columnas]="{
                        Nombre: 'Nombre Proveedor',
                        Nit: 'Nit Proveedor'
                      }" [resultInputText]="['Nombre']" [service]="proveedoresService" tituloBusqueda="Proveedores"
                      [defaultObjValue]="
                        egresoForm.controls['T17Proveedor'].value
                      " fxFlex="60" [readonly]="false"></app-buscadormodal>
                  </div>

                  <div fxLayout="row" fxLayoutAlign="center" fxFlex="50">
                    <mat-label style="padding: 10px;">Tipo de Egreso</mat-label>
                    <app-buscadormodal [filters]="['T17Nombre']" (selected)="onTipoEgresoSelected($event)" [columnas]="{
                        id: 'Id',
                        T17Nombre: 'Nombre'
                      }" [resultInputText]="['T17Nombre']" [isGenericService]="true"
                      [objForGenericService]="objForGenericService" tituloBusqueda="Tipo de Egreso" [defaultObjValue]="
                        egresoForm.controls['T17Clasificacion'].value
                      " fxFlex="60" [readonly]="false"></app-buscadormodal>
                  </div>
                </div>

                <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
                  <div fxLayout="row" fxLayoutAlign="center" fxFlex="50">
                    <app-select label="Forma de Pago" [data]="formasPagos" icono="attach_money" fxFlex
                      [default]="egresoForm.controls['T17FormaPago'].value" (valSelected)="onFormaPagoSelected($event)">
                    </app-select>
                  </div>

                  <mat-form-field fxFlex>
                    <mat-icon matPrefix>attach_money</mat-icon>
                    <input matInput formControlName="T17Valor" matTooltip="Presione enter para guardar el valor"
                      matTooltipPosition="right" (change)="calculateTotal()" id="T17Valor" placeholder="Valor" />
                  </mat-form-field>
                </div>

                <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
                  <mat-form-field fxFlex>
                    <mat-label>Fecha del documento</mat-label>
                    <input matInput [matDatepicker]="pickerFechaDocumento"
                      (dateChange)="onDateChangeFechaDocumento($event)" [value]="egresoForm.controls['T17Fecha'].value"
                      readonly />
                    <mat-datepicker-toggle matSuffix [for]="pickerFechaDocumento"></mat-datepicker-toggle>
                    <mat-datepicker #pickerFechaDocumento></mat-datepicker>
                  </mat-form-field>

                  <mat-form-field fxFlex>
                    <mat-icon matPrefix>edit</mat-icon>
                    <input matInput formControlName="T17Dctos" matTooltip="Presione enter para guardar el valor"
                      matTooltipPosition="right" id="T17Dctos" (change)="calculateTotal()" placeholder="% Descuento" />
                  </mat-form-field>
                </div>

                <div fxLayout="row" fxFlex fxLayoutAlign="space-between flex-start"
                  style="margin-left: 30px; margin-bottom: 10px">
                  <mat-checkbox (change)="onChangeTieneImpuestos($event.checked)" [checked]="tieneImpuestos"
                    [disabled]="showBtnEliminar" color="primary">
                    Tiene m치s impuestos
                  </mat-checkbox>
                </div>
                <mat-card *ngIf="tieneImpuestos" style="margin-bottom: 20px">
                  <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
                    <mat-form-field appearance="outline" readonly fxFlex>
                      <mat-label>ICA</mat-label>
                      <mat-icon matPrefix>edit_off</mat-icon>
                      <input matInput formControlName="T17ICA" id="T17ICA" placeholder="ICA" readonly
                        [disabled]="true" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" readonly fxFlex>
                      <mat-label>IVA</mat-label>
                      <mat-icon matPrefix>edit_off</mat-icon>
                      <input matInput formControlName="T17IVA" id="T17IVA" placeholder="IVA" readonly
                        [disabled]="true" />
                    </mat-form-field>
                    <mat-form-field appearance="outline" readonly fxFlex>
                      <mat-label>Retenci칩n en la fuente</mat-label>
                      <mat-icon matPrefix>edit_off</mat-icon>
                      <input matInput formControlName="T17RF" id="T17RF" placeholder="RF" readonly [disabled]="true" />
                    </mat-form-field>
                  </div>
                </mat-card>


                <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
                  <mat-form-field fxFlex>
                    <mat-icon matPrefix>edit</mat-icon>
                    <input matInput formControlName="T17Observacion" id="T17Observacion" placeholder="Observaciones" />
                  </mat-form-field>
                </div>

                <div fxLayout="row" fxFlex fxLayoutAlign="space-between center">
                  <mat-form-field fxFlex>
                    <mat-icon matPrefix>attach_money</mat-icon>
                    <input matInput formControlName="T17Total" id="T17Total" placeholder="Total" readonly />
                  </mat-form-field>
                </div>

              </mat-card-content>
            </mat-card>
          </form>
        </div>
      </mat-card-content>
      <mat-card-actions fxLayout="row" fxLayoutAlign="center center">
        <button mat-raised-button color="primary" fxLayout="row" fxLayout.xs="column" fxLayoutAlign="center"
          (click)="guardar()" fxFlex [disabled]="!egresoForm.valid" *ngIf="showBtnAdicionar">
          <mat-icon>add_task</mat-icon>
          {{ isUpdating ? "Actualizar" : "Adicionar" }}
        </button>
        <button color="primary" mat-raised-button (click)="actualizar()" fxLayout="row" fxLayout.xs="column"
          fxLayoutAlign="center" fxFlex [disabled]="!egresoForm.valid" *ngIf="showBtnActualizar">
          <mat-icon>loop</mat-icon>
          Actualizar
        </button>
        <button mat-raised-button color="success" fxLayout="row" fxLayout.xs="column" fxLayoutAlign="center" fxFlex
          (click)="pagar()" *ngIf="showBtnEliminar">
          <mat-icon>delete</mat-icon>
          Pagar
        </button>
        <button mat-raised-button color="warn" (click)="cancelar()" fxLayout="row" fxLayout.xs="column"
          fxLayoutAlign="center" fxFlex>
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>
      </mat-card-actions>
    </mat-card>
  </mat-card-content>
</div>